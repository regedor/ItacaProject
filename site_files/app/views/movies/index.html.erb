<% content_for :page_title do %>Lista de Filmes<% end %>


<div id=movies-index-list class=resource-list>
  <p>
    A Base de Dados Imagens e Sonoridades das Migrações conta, neste momento, com <%= Movie.count %> filmes.
  </p>

  <div id="search_filters">
  <% form_tag movies_path, :method => 'get' do %>
    <div class="search_field">
      <%= label :author_id, 'Author' %>
      <%= select_tag 'author_id', options_for_select(
            [["-- Todos --",'']] + Author.find(:all, :order => 'name').map { |o| [o.name, o.id] },
            params[:author_id].to_i) %>
    </div>
    <div class="search_field">
      <%= label :director_id, 'Director' %>
      <%= select_tag 'director_id', options_for_select(
            [["-- Todos --",'']] + Director.find(:all, :order => 'name').map { |o| [o.name, o.id] },
            params[:director_id].to_i) %>
    </div>
    <div class="search_field">
      <%= label :genre_id, 'Genre' %>
      <%= select_tag 'genre_id', options_for_select(
            [["-- Todos --",'']] + Genre.find(:all, :order => 'name').map    { |o| [o.name, o.id] },
            params[:genre_id].to_i) %>
    </div>
    <div class="search_field">
      <%= label :keywords, 'Palavras&nbsp;chave' %>
      <%= text_field_tag 'keywords', params[:keywords], :size => 32 %>
    </div>
    <%= submit_tag 'Pesquisar', :name => nil %>                        
  <% end %> 

  <p>
    <% unless params[:author_id] || params[:director_id] || params[:genre_id] || params[:keywords] %>
      A listagem de filmes pode ser limitada através de uma pesquisa.
      Introduza os parametros e carregue em pesquisar.
    <% else %>
    <% if @movies.count == 0 %>
      Não foram encontrados filmes.
    <% elsif @movies.count == 1 %>
      Foi encontrado 1 filme.
    <% else %>
      Foram encontrados <%= @movies.count %> filmes.
    <% end %> 
    Para desfazer a pesquisa click <%= link_to 'aqui', movies_path %>.
    <% end %>
  </p>
  </div>


  <table>

    <tr class="table-header">
      <th class="main"> <%=h "Title".humanize %>          </th>
      <th>              <%=h "Director".humanize %>       </th>
      <th>              <%=h "Genre".humanize %>         </th>
    </tr>
  
    <% for movie in @movies %>
    <tr <%= cycle "", "class='odd'"%> href="<%= movie_path(movie)%>">
      <td class="main">
        <%= link_to h(truncate(movie.title,46,"...")), movie_path(movie), :title => movie.synopsis %>            
      </td>
      <td class="director">
        <%= link_to h(truncate(directors_names(movie),43,"...") || ""), movie_path(movie), :title => movie.synopsis %> 
      </td>
      <td class="genre">
        <%= link_to h(movie.genre && truncate(movie.genre.name,15,"...") || ""), movie_path(movie), :title => movie.synopsis %> 
      </td>
    </tr>
    <% end %>

  </table>
</div>


